# Aegis Phase 2 - Implementation Guide

## Overview

This document covers the implementation of Aegis Modules 2.1, 3.1, and 3.2:

- **Module 2.1**: Label Helper Integration (Command Deck)
- **Module 3.1**: Contributor Dashboard (Community Spotlight)
- **Module 3.2**: Contributor Journey Timeline (Community Spotlight)

## Module 2.1: Label Helper Integration

### Purpose
Manage GitHub issue labels directly from the dashboard with write permissions.

### Components

#### Backend (Vercel Serverless Function)
- **File**: `api/labels.py`
- **Endpoints**:
  - `GET /api/labels?repo=owner/name` - List available labels
  - `POST /api/labels` - Add labels to issue
  - `DELETE /api/labels` - Remove label from issue

#### Frontend (Vue Component)
- **File**: `frontend/src/components/LabelManager.vue`
- **Features**:
  - Search labels by name/description
  - Add/remove labels from issues
  - Visual feedback with color coding
  - Real-time updates

### Setup

1. **Deploy to Vercel**:
   ```bash
   # Install Vercel CLI
   npm install -g vercel
   
   # Login to Vercel
   vercel login
   
   # Deploy from repo root
   vercel --prod
   ```

2. **Configure Environment Variables in Vercel**:
   - Go to Vercel Dashboard â†’ Project Settings â†’ Environment Variables
   - Add: `GITHUB_TOKEN` = Your GitHub Personal Access Token (with `repo` scope)

3. **Update Frontend Configuration**:
   ```bash
   # Add to frontend/.env
   VITE_API_URL=https://your-vercel-app.vercel.app/api/labels
   ```

### Usage

1. Open any repository detail modal
2. Click "Manage Labels" button
3. Search and add/remove labels from issues
4. Changes are applied immediately to GitHub

### Security Notes

- The GitHub token requires `repo` scope for write access
- Use a dedicated service account for production
- Token is stored securely in Vercel environment variables
- Frontend never accesses the token directly

---

## Module 3.1: Contributor Dashboard

### Purpose
Display aggregated analytics for all contributors across all repositories.

### Components

#### Data Aggregation Script
- **File**: `aggregate_contributors.py`
- **Input**: `docs/repositories-data.json`
- **Output**: `docs/contributor-stats.json`
- **Features**:
  - Total contributions per contributor
  - Repository count and distribution
  - Language diversity analysis
  - Impact score calculation
  - Newcomer detection (last 30 days)

#### Frontend (Vue Component)
- **File**: `frontend/src/components/ContributorDashboard.vue`
- **Features**:
  - Top contributors leaderboard
  - Newcomers showcase
  - Global map placeholder
  - Sortable statistics

### Data Structure

```json
{
  "updated_at": "2025-11-16T16:00:00",
  "total_contributors": 150,
  "top_contributors": [
    {
      "login": "developer1",
      "avatar_url": "https://...",
      "total_contributions": 1250,
      "total_repositories": 12,
      "impact_score": 567.8,
      "languages": ["Python", "JavaScript"],
      "repositories": [...]
    }
  ],
  "newcomers": [...],
  "statistics": {
    "total_contributions": 5430,
    "avg_contributions_per_contributor": 36.2
  }
}
```

### Access

Navigate to `/contributors` route (requires router integration).

---

## Module 3.2: Contributor Journey Timeline

### Purpose
Show chronological activity timeline for individual contributors across all projects.

### Components

#### Frontend (Vue Component)
- **File**: `frontend/src/components/ContributorJourney.vue`
- **Features**:
  - Visual timeline of contributions
  - First contribution milestone
  - Repository-by-repository breakdown
  - Contribution distribution chart
  - Language tags

### Data Source

Uses same `contributor-stats.json` generated by Module 3.1.

### Timeline Events

1. **First Contribution** (green marker) - Initial commit timestamp
2. **Repository Milestones** (blue markers) - Each repo contribution
3. **Latest Activity** (purple, pulsing) - Most recent contribution

### Access

From Contributor Dashboard, click any contributor to view their journey.

---

## Integration Steps

### 1. GitHub Actions Workflow

Already integrated in `.github/workflows/deploy.yml`:

```yaml
- name: Aggregate contributor statistics
  run: python aggregate_contributors.py docs/repositories-data.json docs/contributor-stats.json
```

### 2. Router Configuration

Add routes to `frontend/src/router/index.ts` (create if needed):

```typescript
import { createRouter, createWebHistory } from 'vue-router'
import ContributorDashboard from './components/ContributorDashboard.vue'
import ContributorJourney from './components/ContributorJourney.vue'

const routes = [
  {
    path: '/contributors',
    name: 'Contributors',
    component: ContributorDashboard
  },
  {
    path: '/contributors/:login',
    name: 'ContributorJourney',
    component: ContributorJourney,
    props: true
  }
]

export const router = createRouter({
  history: createWebHistory(),
  routes
})
```

### 3. Navigation

Add link to main dashboard:

```vue
<router-link to="/contributors" class="nav-link">
  ðŸ‘¥ Contributors
</router-link>
```

---

## Testing

### Local Development

1. **Generate contributor data**:
   ```bash
   python aggregate_contributors.py docs/repositories-data.json docs/contributor-stats.json
   ```

2. **Copy to frontend public directory**:
   ```bash
   cp docs/contributor-stats.json frontend/public/
   ```

3. **Run dev server**:
   ```bash
   cd frontend
   npm run dev
   ```

4. **Test Label Manager**:
   - Deploy functions locally with Vercel CLI:
     ```bash
     vercel dev
     ```
   - Access at `http://localhost:3000`

### Production Verification

1. **Check contributor stats**:
   - Visit `https://your-domain.com/contributor-stats.json`
   - Verify JSON structure

2. **Check Label Manager API**:
   ```bash
   curl https://your-vercel-app.vercel.app/api/labels?repo=owner/name
   ```

---

## Performance Considerations

### Data Aggregation
- Runs on every deployment (daily cron + manual triggers)
- Processing time: ~2-5 seconds for 88 repos
- Output file size: ~500KB for 150 contributors

### Frontend Loading
- Lazy load contributor data on route navigation
- Virtual scrolling for large contributor lists (future enhancement)
- Image lazy loading for avatars

### API Rate Limits
- Label Manager uses authenticated GitHub API
- Rate limit: 5000 requests/hour
- Implement client-side caching for label lists

---

## Future Enhancements

### Module 2.1 Enhancements
- [ ] Bulk label operations
- [ ] Label templates
- [ ] Label suggestions based on issue content
- [ ] GitHub App integration for better security

### Module 3.1 Enhancements
- [ ] Interactive global contributor map
- [ ] Contribution heatmap calendar
- [ ] Language proficiency indicators
- [ ] Collaboration graph (contributor-to-contributor)

### Module 3.2 Enhancements
- [ ] Commit message analysis
- [ ] Code review statistics
- [ ] Issue/PR activity timeline
- [ ] Skill evolution over time

---

## Troubleshooting

### Label Manager Issues

**Error: "GITHUB_TOKEN environment variable not set"**
- Solution: Configure token in Vercel environment variables

**Error: "403 Forbidden"**
- Solution: Ensure GitHub token has `repo` scope

### Contributor Dashboard Issues

**Empty contributor list**
- Solution: Run `aggregate_contributors.py` to generate data
- Check that `repositories-data.json` contains contributor arrays

**Newcomers not showing**
- Solution: Verify `first_contribution` timestamps in data
- Check date calculation in aggregation script

---

## Support

For issues or questions:
1. Check GitHub Actions logs for data generation errors
2. Verify Vercel deployment logs for API issues
3. Use browser DevTools Network tab to debug API calls
4. Review component console logs for client-side errors
